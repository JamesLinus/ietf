<html><head><title>wdiff draft-jennings-rtcweb-signaling-gateway.txt.old draft-jennings-rtcweb-signaling-gateway.txt</title></head><body>
<pre>

Network Working Group                                        C. Jennings
Internet-Draft                                             S. Nandakumar
Intended status:  Informational                                    Cisco
Expires:  April 22, 2012                                     C. Holmberg
                                                                Ericsson
                                                        October 20, 2011

           SIP to RTCWeb Offer/Answer Protocol (ROAP) Gateway
               draft-jennings-rtcweb-signaling-gateway-00

Abstract

   This document proposes behavior of a RTCWeb signaling gateway for
   mapping message representations between RTCWeb Offer/Answer Protocol
   (ROAP) scheme and native SIP messaging scheme.  Such a signaling
   gateway is intended to translate to and from/SIP for enabling use
   cases between a RTCWeb enabled browser and legacy SIP devices.

Status of this Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on April 22, 2012.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . . . 3
   2.  Mapping to SIP  . . . . . . . . . . . . . . . . . . . . . . . . 3
     2.1.  Handling SIP Requests . . . . . . . . . . . . . . . . . . . 5
     2.2.  Handling SIP Responses  . . . . . . . . . . . . . . . . . . 5
     2.3.  Handling Web Messages . . . . . . . . . . . . . . . . . . . 6
     2.4.  Limitations . . . . . . . . . . . . . . . . . . . . . . . . 6
   3.  Security Considerations . . . . . . . . . . . . . . . . . . . . 7
   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . . . 7
   5.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . 7
   6.  References  . . . . . . . . . . . . . . . . . . . . . . . . . . 7
     6.1.  Normative References  . . . . . . . . . . . . . . . . . . . 7
     6.2.  Informative References  . . . . . . . . . . . . . . . . . . 7
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . . . 7

1.  Introduction

   This specification suggests one possible way to build a RTCWeb
   Signaling gateway that maps message representations proposed in
   [ROAP] to native SIP [RFC3261] messages and vice-versa.  The
   specification [ROAP] describes a signaling protocol for RTCWeb to
   support negotiation of media session using SDP offer/answer
   [RFC3264].  Such a singaling protocol enables an RTCWeb browser to
   setup media sessions to another browser or a SIP device.  For
   Browser-to-SIP device use case, the signaling gateway connects to
   legacy SIP devices such and SHALL translate messages between ROAP and
   SIP native messages schemes.

2.  Mapping to SIP

   The design requires the gateway to be SIP transaction statefull but
   does not require any storage of longer term state.  The information
   that remains constant over the SIP dialog is stored in session tokens
   while the information that is needed to from a SIP response is stored
   in response tokens.  The gateway appears as a SIP UA to the sip side.
   Message on the two sides of the signalling gateway are referred to as
   the SIP side and web side.

   The following message flows shows an example where the callee is on
   the web side and uses a signaling gateway to reach the callee on the
   SIP side.

  participant CallerUA
  participant CallerJS
  participant SIPGW
  participant CalleeUA

  CallerJS-&gt;CallerUA: peer=new PeerConnection();

  CallerJS-&gt;CallerUA: peer-&gt;addStream();
  CallerUA-&gt;CallerJS: sendSignalingChannel();
  CallerJS-&gt;SIPGW: {"type":"OFFER", "sdp":"..."}
  SIPGW-&gt;CalleeUA: SIP INVITE
  note right of CalleeUA: Alert user

  CalleeUA-&gt;CallerUA: ICE Checking

  CalleeUA-&gt;SIPGW: SIP 180 w/SDP
  SIPGW-&gt;CallerJS: {"type":"TENTATIVE_ANSWER", "sdp":"..."}
  note right of CallerJS: This SDP has ICE candidates
  CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
  CallerUA-&gt;CallerJS: onstatechange();
  note left of CallerUA: Might have one way\nmedia flowing at this point

  CallerUA-&gt;CalleeUA: More ICE checking
  CalleeUA-&gt;CallerUA: ICE Completes
  CallerUA-&gt;CallerJS: onopen();

  CalleeUA-&gt;SIPGW: SIP 200
  SIPGW-&gt;CallerJS: {"type":"ANSWER", "sdp":"..."}
  CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
  CallerUA-&gt;CallerJS: onopen();

  CalleeUA-&gt;CallerUA: Two-way Media
  note right of CalleeUA: Media plays

  CallerUA-&gt;CallerJS: sendSignalingChannel();
  CallerJS-&gt;SIPGW: {"type":"OK" }
  SIPGW-&gt;CalleeUA: SIP ACK

  note right of CalleeUA: Callee decides to add video

  CalleeUA-&gt;SIPGW: SIP ReINVITE
  SIPGW-&gt;CallerJS: {"type":"OFFER", "sdp":"..."}
  CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();

  CallerUA-&gt;CallerJS: sendSignalingChannel();
  CallerJS-&gt;SIPGW: {"type":"ANSWER", "sdp":"..."}
  SIPGW-&gt;CalleeUA: SIP 200

  CalleeUA-&gt;SIPGW: SIP ACK
  SIPGW-&gt;CallerJS: {"type":"OK" }
  CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
  CallerUA-&gt;CallerJS: onaddstream();

  note left of CallerUA: Caller decides to end the session

  CallerJS-&gt;CallerUA: peer-&gt;close();
  CallerUA-&gt;CallerJS: sendSignalingChannel();
  CallerJS-&gt;SIPGW: {"type":"SHUTDOWN"}
  SIPGW-&gt;CalleeUA: SIP BYE
  CalleeUA-&gt;SIPGW: SIP 200
  SIPGW-&gt;CallerJS: {"type":"OK"}
  CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();

2.1.  Handling SIP Requests

   When the signalling gateway receives a SIP request, the gateway forms
   the message on the web request side in the following way:
   1.  The SIP methods INVITE, ACK, BYE, CANCEL are mapped to
       messageType OFFER, OK, SHUTDOWN, SHUTDOWN respectively
   2.  The Seq on web side is formed from the numeric portion of CSeq
       header field value from the SIP side.
   3.  The callerSessionId is formed by a JSON object string that has an
       call-id attribute containing the SIP call-id header field value
       and a from-tag attribute containing the SIP from-tag.
   4.  If there is a SIP to-tag, it is used for the calleeSessionId.
   5.  If there is a SIP body containing SDP, it is copied into the SDP
       parameter on web side.
   6.  The setSessionToken is formed by a JSON object string that has
       and contact attribute that contains the SIP contact header field
       value and an route attribute which is an array that has the
       values of the SIP route header field values in reverse order.
   7.  The setResponseToken formed by a JSON object string that has and
       via attribute that is an array containing the SIP via headers
       field values.  The JSON object also includes an attribute that
       holds the request method.  The gateway MAY include any other SIP
       headers in an attribute named headers which is an array with one
       header field in each entry.

2.2.  Handling SIP Responses

   When the signalling gateway receives a SIP response, the gateway
   forms the message on the web request side in the following way:
   1.  The SIP responses 180 is mapped to ANSWER with more_coming.  A
       200 response that contains SDP is mapped to ANSWER. 481 is mapped
       to NOMATCH. 408 is mapped to TIMEOUT. 486 is mapped to REFUSED.
       491 is mapped to CONFLICT.  All other SIP 3xx to 6xx responses
       are mapped to FAILED.
   2.  The Seq on web side is formed from the numeric portion of CSeq
       header field value from the SIP side.
   3.  The callerSessionId is formed by a JSON object string that has an
       call-id attribute containing the SIP call-id header field value
       and a from-tag attribute containing the SIP from-tag.
   4.  The SIP to-tag is used for the calleeSessionId.
   5.  If there is a SIP body containing SDP, it is copied into the SDP
       parameter on web side.
   6.  The setSessionToken is formed by a JSON object string that has
       and contact attribute that contains the SIP contact header field
       value and an route attribute which is an array that has the
       values of the SIP route header field values.

   7.  The setResponseToken formed by a JSON object string that has and
       via attribute that is an array containing the SIP via headers
       field values.  The gateway MAY include any other SIP headers in
       an attribute named headers which is an array with one header
       field in each entry.

2.3.  Handling Web Messages

   When the signalling gateway receives a WEB message, the gateway forms
   the message on the SIP side in the following way:
   1.   The messageType OFFER, ANSWER with more_coming, ANSWER, OK,
        NOMATCH, TIMEOUT, REFUSED, CONFLICT, FAILED are mapped to
        INVITE, 180, 200, ACK, 481, 408, 486, 491, 500 respectively.
   2.   The messageType SHUTDOWN is mapped to a CANCEL if the
        calleeSessionId is empty and to BYE otherwise
   3.   For SIP responses, The numeric portion of the CSeq is formed by
        taking the number portion from the Seq field.  If the
        setResponseToken contains a method name, that is used for the
        method portion of the CSeq otherwise if it does not exist, the
        request method of the SIP message is used.
   4.   The Call-ID header field values is formed from the call-id
        attribute of the callerSessionId.
   5.   The from-tag is formed from the from-tag attribute of the
        callerSessionId.
   6.   If there is a calleeSessionId, it is used for the SIP to-tag.
   7.   If there is a SDP parameter, it is used as a SIP SDP body and
        the content type of and content length headers are set
        appropriately.
   8.   If there is a sessionToken that contains a contact attribute, it
        is used to form the SIP contact header field value.
   9.   If there is a sessionToken that contains a route array, it is
        used to form the SIP route header field values.
   10.  If there is a responseToken that contains a via array, it is
        used to form the SIP via header field values.

2.4.  Limitations

   The following things, if used on the SIP side, will not interoperate:

   o  Redirection via 3xx
   o  UPDATE / PRACK
   o  REFER
   o  SIP to pre RFC 3261 devices that don't support to and from tags.
   o  SUB/NOTify
   o  SIP INVITES that do not contain an SDP offer
   o  SIP extensions to RFC 3261.

3.  Security Considerations

   TBD

4.  IANA Considerations

   This document requires no actions from IANA.

5.  Acknowledgments

   Many thanks for comment, ideas, and text from Eric Rescorla, Harald
   Alvestrand, Magnus Westerlund, Ted Hardie, and Stefan Hakansson.

6.  References

6.1.  Normative References

   [RFC3264]  Rosenberg, J. and H. Schulzrinne, "An Offer/Answer Model
              with Session Description Protocol (SDP)", RFC 3264,
              June 2002.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

6.2.  Informative References

   [RFC3261]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", RFC 3261,
              June 2002.

   [I-D.ietf-rtcweb-use-cases-and-requirements]
              Holmberg, C., Hakansson, S., and G. Eriksson, "Web Real-
              Time Communication Use-cases and Requirements",
              draft-ietf-rtcweb-use-cases-and-requirements-06 (work in
              progress), October 2011.

   [ROAP]     Jennings, C. and J. Rosenberg, "RTCWeb Offer/Answer
              Protocol (ROAP)", draft-jennings-rtcweb-signaling (work in
              progress), October 2011.

Authors' Addresses

   Cullen Jennings
   Cisco
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   Phone:  +1 408 421-9990
   Email:  fluffy@cisco.com

   Suhas Nandakumar
   Cisco
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   Email:  snandaku@cisco.com

   Christer Holmberg
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   Email:  christer.holmberg@ericsson.com
</pre>
</body></html>
